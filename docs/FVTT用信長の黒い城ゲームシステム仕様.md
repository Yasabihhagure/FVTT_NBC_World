# FVTT用信長の黒い城ゲームシステムモジュール

## 概要

これはFoundy Virturl Tabletop（VFTT） で使用する、ゲームシステムモジュールの仕様書です。

## モジュールの配布方法

完成したシステムモジュールはGitHubのリポジトリへプッシュし、VFTT側からsystem.jsonを読ませることでインストールします。

## 要件

### 表示言語について

このシステムは複数言語（主要言語4種類と日本語）で提供すること。
言語は使用時に選択可能であること。
初期設定は英語であること。

## 機能

モジュールの機能として、以下の要素があります。

* 複数のキャラクターをグループとして扱えるようにする機能
* 信長の黒い城のプレイヤーキャラクターを作成しキャラクターとして登録する機能
* 敵モンスターをプリセットから選択しキャラクターとして登録する機能
* キャラクターのダメージを反映させる機能
* キャラクターに状態異常を追加、削除する機能
* グループの状態により、士気チェックを行う機能

## 詳細仕様

### キャラクターデータ構造
* 基本的に「簡易キャラクター」も「上級クラスキャラクター」も同一のデータ構造（キャラクターシート）を使用します。
* 差異は「特殊能力の有無」と「初期武装」のみです。
* **HP決定ルール**: 簡易キャラクターのHPは `1d8 + 耐久` で算出します。結果が0以下の場合は `1` とします。また、「耐久」の値が算出できない場合は外部仕様書の定義に従います（不明な場合は暫定で0またはルールブック準拠）。

### 戦闘・攻撃サイクル
* 敵キャラクター（NPC）の攻撃方法は、ターン毎に固定されるのではなく、**GMがその都度選択可能**なリストとして提示されます。
* これは、同種の敵が複数体いる場合に、全員が同じ攻撃を行う単調さを防ぐためです。
* システムは現在のターン数に応じた「推奨攻撃」をハイライト表示する等の支援を行いますが、決定権はGMにあります。

### 士気チェック (Morale Check)
* **概要**: NPCの士気を判定し、戦闘継続か逃走/降伏を決定する機能。
* **対象**: プレイヤーチーム以外のチーム（敵NPCチーム）。
* **タイミング**: ユーザーの任意（基本はターン終了時や特定イベント発生時）。
* **実装機能**:
    * **個別士気チェック**:
        * アクターシートの士気値の横にある「サイコロ」アイコンで行う。
        * 士気値が数値の場合: `2d6 >= 士気値` で失敗（士気崩壊）。
        * 失敗時: さらに `1d6` を振り、 `1-3` で逃走、`4-6` で降伏。
        * 士気値が文字列の場合: その条件をチャットに表示。
    * **部隊士気チェック (Group Morale Check)**:
        * アクターシートの「複数人」アイコンで行う。
        * **グループ判定ロジック**:
            * **優先**: 判定対象のアクターが「フォルダ」に含まれている場合、同じフォルダ内のアクターを同グループとする。
            * **次点**: フォルダに含まれていない場合、名前（ベース名）が一致、または前方一致するアクター（例: "足軽" と "足軽 1"）を同グループとする。
        * **判定トリガー**: 以下のいずれかを満たすと、グループ全員に対して個別士気チェックが自動実行される。
            1. **リーダー撃破**: 「リーダー」属性を持つメンバーが死亡 (HP <= 0) している。
            2. **半数以上無力化**: グループメンバーの半数以上が死亡 (HP <= 0) している。
            3. **単騎消耗**: グループが残り1名（最初から単独、または最後の一人）で、かつ HP <= 1/3 (MaxHP) である。
        * **チャット出力**: 
            * 達成した条件（例: "リーダー撃破"）を表示。
            * 生存メンバー全員の判定結果（成功/失敗、逃走/降伏）を一覧表示。
            * トークン名が "Character" 等のデフォルト名の場合、アクター名で表示する。
    * **リーダー設定**:
        * 各NPCのシートヘッダー（HP・士気欄の並び）にある「リーダー(Leader)」チェックボックスで設定可能。
    * **連動設定**:
        * `hp` という文字列が士気値に設定されている場合、現在HPを目標値として扱う（動的リンク）。

## 次回実装予定機能

### 状態異常 (Status Effects)
TBD

### 特殊能力 (Special Abilities)
TBD

### 複数のキャラクターをグループとして扱う機能


プレイヤーチームや、敵チームといったように特定の集団をまとめて扱うための概念です。
例えば、チーム内の半数が倒れた場合、士気チェックが必要などの判定でグループの生存率が必要になるケースを想定しています。
グループ数は最大4グループを想定しており、最初のグループは常にプレイヤーグループとします。

### 信長の黒い城のプレイヤーキャラクターを作成しキャラクターとして登録する機能

信長の黒い城には複数のキャラクター作成方法が用意されています。
大きく分けて2種類そんざいしており一つは「簡易キャラクター」もう一つは「上級クラスキャラクター」です。
簡易キャラクターと異なり上級キャラクターには複数のクラスが存在しています。
また、簡易キャラクターと異なり上級キャラクターには複数の選択項目があります。
上級キャラクターは武装や所持品についても簡易キャラクターとは異なったルールで設定されます。

#### 簡易キャラクターの作成

以下のファイルに人間キャラクター作成についての記述があるので、このドキュメントから簡易キャラクター作成に関する機能仕様書を作成してください。作成後に簡易キャラクターに関する修正があった場合、作成した仕様書を更新してください。
https://github.com/Yasabihhagure/NBCBattleSimulator/blob/main/docs/NBCBattleSimulator%E4%BB%95%E6%A7%98v15r.md

#### 上級クラスキャラクターの作成

簡易キャラクターと同様に上級キャラクター作成に関する仕様書を作成してください。

ただし、現時点で参照する資料は存在しないので、ファイルと簡単な見出しだけを作成するだけにしてください。

## 敵モンスターをプリセットから選択しキャラクターとして登録する機能

敵のモンスターと個体数設定し選んだグループへキャラクターとして登録する機能です。
敵モンスター以外に、人間キャラクター（簡易キャラクターと上級クラスキャラクター）も登録可能にしてください。
敵モンスターのプリセットはhttps://github.com/Yasabihhagure/NBCBattleSimulator/blob/main/docs/NBCBattleSimulator%E4%BB%95%E6%A7%98v15r.md
を参照して、敵キャラクタープリセット仕様を作成してください。

登録したキャラクターはGMが利用する際にに攻撃方法と特別ルールを参照できるようにしてください。

